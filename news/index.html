<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News – Sonce Slovenije</title>
    <meta name="description" content="Novice in objave Sindikat Sonce Koper.">
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/news/news.css">
</head>
<body class="bg-gray-50">
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="/" class="flex items-center gap-3">
                    <img src="/images/soncelogo.jpg" alt="Sonce Slovenije" class="h-10" loading="eager" decoding="async">
                    <span class="text-gray-900 font-semibold">Sonce Slovenije</span>
                </a>
                <nav class="hidden md:flex items-center gap-6">
                    <a href="/" class="text-gray-700 hover:text-primary">Domov</a>
                    <a href="/news/" class="text-primary font-semibold">News</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-10 max-w-6xl">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-8">News</h1>
        <div id="news-list" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
        <p id="empty-state" class="hidden text-gray-600">Ni objav za prikaz.</p>
    </main>

    <footer class="mt-16 py-8 text-center text-gray-500 text-sm">
        <p>&copy; <span id="year"></span> Sonce Slovenije</p>
    </footer>

    <script>
        (function(){
            function escapeHtml(str){
                const p = document.createElement('p');
                p.appendChild(document.createTextNode(str || ''));
                return p.innerHTML;
            }
            function formatDate(iso){
                try { return new Date(iso).toLocaleDateString('sl-SI', { year:'numeric', month:'long', day:'numeric' }); } catch(e){ return iso || ''; }
            }
            function render(posts){
                const list = document.getElementById('news-list');
                const empty = document.getElementById('empty-state');
                if (!posts || posts.length === 0){ empty.classList.remove('hidden'); return; }
                const frag = document.createDocumentFragment();
                posts.forEach(p => {
                    const a = document.createElement('a');
                    a.href = `/news/post.html?slug=${encodeURIComponent(p.slug)}`;
                    a.className = 'news-card block rounded-2xl overflow-hidden bg-white border border-gray-100 shadow-sm hover:shadow-md transition-shadow';
                    a.innerHTML = `
                        <div class="aspect-[16/9] bg-gray-100 overflow-hidden">
                            <img src="${escapeHtml(p.hero || '')}" alt="${escapeHtml(p.title || '')}" class="w-full h-full object-cover" loading="lazy" decoding="async" onerror="this.style.display='none'">
                        </div>
                        <div class="p-5">
                            <div class="text-sm text-gray-500">${formatDate(p.date)}${p.author ? ` • ${escapeHtml(p.author)}` : ''}</div>
                            <h2 class="mt-2 text-xl font-semibold text-gray-900">${escapeHtml(p.title)}</h2>
                            <p class="mt-2 text-gray-700 line-clamp-3">${escapeHtml(p.excerpt || '')}</p>
                            <span class="mt-4 inline-flex items-center gap-2 text-primary font-medium">Preberi več <i class="fa-solid fa-arrow-right"></i></span>
                        </div>`;
                    frag.appendChild(a);
                });
                list.appendChild(frag);
            }
            async function load(){
                try {
                    const res = await fetch('/content/news/index.json', { cache: 'no-cache' });
                    if (!res.ok) throw new Error('Failed to load index.json');
                    const data = await res.json();
                    const posts = Array.isArray(data) ? data : Array.isArray(data.posts) ? data.posts : [];
                    posts.sort((a,b)=> (b.date||'').localeCompare(a.date||''));
                    render(posts);
                } catch (e) {
                    document.getElementById('empty-state').textContent = 'Napaka pri nalaganju novic.';
                    document.getElementById('empty-state').classList.remove('hidden');
                }
            }
            document.getElementById('year').textContent = new Date().getFullYear();
            load();
        })();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" defer></script>
</body>
</html>