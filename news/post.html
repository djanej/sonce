<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objava – Sonce Slovenije</title>
    <meta name="description" content="Objava novic Sindikat Sonce Koper.">
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/news/news.css">
</head>
<body class="bg-gray-50">
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="/" class="flex items-center gap-3">
                    <img src="/images/soncelogo.jpg" alt="Sonce Slovenije" class="h-10" loading="eager" decoding="async">
                    <span class="text-gray-900 font-semibold">Sonce Slovenije</span>
                </a>
                <nav class="hidden md:flex items-center gap-6">
                    <a href="/" class="text-gray-700 hover:text-primary">Domov</a>
                    <a href="/news/" class="text-primary font-semibold">News</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-10 max-w-3xl">
        <a href="/news/" class="text-primary hover:underline">← Nazaj na novice</a>
        <article class="mt-4 bg-white border border-gray-100 rounded-2xl shadow-sm overflow-hidden">
            <div id="hero" class="aspect-[16/9] bg-gray-100 overflow-hidden hidden">
                <img id="hero-img" src="" alt="" class="w-full h-full object-cover" loading="lazy" decoding="async">
            </div>
            <div class="p-6">
                <h1 id="title" class="text-3xl font-bold text-gray-900"></h1>
                <div id="meta" class="mt-2 text-sm text-gray-500"></div>
                <div id="tags" class="mt-3 flex flex-wrap gap-2"></div>
                <div id="content" class="news-article mt-6"></div>
                <p id="post-empty" class="hidden text-gray-600">Objava ni najdena.</p>
            </div>
        </article>
    </main>

    <footer class="mt-16 py-8 text-center text-gray-500 text-sm">
        <p>&copy; <span id="year"></span> Sonce Slovenije</p>
    </footer>

    <script>
        (function(){
            const els = {
                year: document.getElementById('year'),
                title: document.getElementById('title'),
                meta: document.getElementById('meta'),
                hero: document.getElementById('hero'),
                heroImg: document.getElementById('hero-img'),
                tags: document.getElementById('tags'),
                content: document.getElementById('content'),
                empty: document.getElementById('post-empty')
            };

            function escapeHtml(str){
                const p = document.createElement('p');
                p.appendChild(document.createTextNode(str || ''));
                return p.innerHTML;
            }
            function formatDate(iso){
                try { return new Date(iso).toLocaleDateString('sl-SI', { year:'numeric', month:'long', day:'numeric' }); } catch(e){ return iso || ''; }
            }
            function getParam(name){
                const qs = new URLSearchParams(location.search);
                return qs.get(name);
            }

            function showEmpty(msg){
                els.empty.textContent = msg || 'Objava ni najdena.';
                els.empty.classList.remove('hidden');
            }

            function renderTags(tags){
                els.tags.innerHTML = '';
                if (!tags || !tags.length) return;
                const frag = document.createDocumentFragment();
                tags.forEach(t => {
                    const a = document.createElement('a');
                    a.href = `/news/?tag=${encodeURIComponent(t)}`;
                    a.textContent = t;
                    a.className = 'tag-pill';
                    frag.appendChild(a);
                });
                els.tags.appendChild(frag);
            }

            async function load(){
                const slug = getParam('slug');
                if (!slug){ showEmpty('Manjka parameter objave.'); return; }
                try {
                    const res = await fetch('/content/news/index.json', { cache: 'no-cache' });
                    const data = await res.json().catch(()=>[]);
                    const posts = Array.isArray(data) ? data : Array.isArray(data.posts) ? data.posts : [];
                    const post = posts.find(p => String(p.slug) === slug);
                    if (!post){ showEmpty('Objava ni najdena.'); return; }
                    els.title.textContent = post.title || '';
                    els.meta.textContent = `${formatDate(post.date)}${post.author ? ` • ${post.author}` : ''}`;
                    renderTags(post.tags || []);
                    if (post.hero){
                        els.heroImg.src = post.hero;
                        els.heroImg.alt = post.title || '';
                        els.hero.classList.remove('hidden');
                        els.heroImg.onerror = () => { els.hero.classList.add('hidden'); };
                    }
                    const htmlRes = await fetch(`/content/news/${encodeURIComponent(slug)}.html`, { cache: 'no-cache' });
                    if (!htmlRes.ok){ showEmpty('Vsebina objave ni na voljo.'); return; }
                    const html = await htmlRes.text();
                    els.content.innerHTML = html;
                } catch (e){
                    showEmpty('Napaka pri nalaganju objave.');
                }
            }

            els.year.textContent = new Date().getFullYear();
            load();
        })();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" defer></script>
</body>
</html>